<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SWEET MASTER: KEKECAN ED.</title>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-dark: #050510;
            --neon-pink: #ff0055;
            --neon-blue: #00f2ff;
            --neon-green: #00ff66;
            --gold: #ffd700;
            --panel-bg: rgba(10, 10, 25, 0.95);
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            height: 100dvh;
            background: radial-gradient(circle at center, #1b1b3a 0%, #050510 100%);
            font-family: 'Orbitron', sans-serif;
            color: white;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- ÃœST PANEL --- */
        .top-bar {
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            background: rgba(0,0,0,0.6);
            border-bottom: 2px solid var(--neon-blue);
            box-shadow: 0 0 20px var(--neon-blue);
            z-index: 100;
        }

        .menu-icon { font-size: 1.8rem; color: var(--neon-blue); cursor: pointer; }

        .balance-box {
            background: linear-gradient(90deg, #111, #333);
            padding: 8px 20px;
            border-radius: 50px;
            border: 2px solid var(--gold);
            font-weight: 900;
            font-size: 1.1rem;
            color: var(--gold);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* --- OYUN ALANI --- */
        #game-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            padding: 10px;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 5px;
            width: 100%;
            max-width: 450px;
            aspect-ratio: 6/5;
            background: rgba(255,255,255,0.05);
            padding: 8px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(5px);
            transition: 0.3s;
        }
        
        /* YEÅžÄ°L IÅžIK MODU */
        .green-light-mode {
            border: 3px solid var(--neon-green) !important;
            box-shadow: 0 0 50px var(--neon-green), inset 0 0 50px var(--neon-green);
        }

        .symbol {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            position: relative;
        }

        .matched {
            animation: pulse 0.5s infinite;
            filter: brightness(1.5);
            background: rgba(255, 255, 255, 0.2);
        }

        .falling { animation: bounceInDown 0.6s; }
        .popping { animation: zoomOut 0.3s forwards; }

        /* --- ALT KONTROLLER --- */
        .controls {
            height: 100px;
            background: var(--panel-bg);
            border-top: 2px solid var(--neon-pink);
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 10px;
            box-shadow: 0 -10px 30px rgba(255, 0, 85, 0.2);
        }

        .spin-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--neon-pink), #990033);
            border: 4px solid #fff;
            color: #fff;
            font-size: 1.2rem;
            font-weight: 900;
            box-shadow: 0 0 20px var(--neon-pink);
            cursor: pointer;
            transition: 0.1s;
        }
        .spin-btn:active { transform: scale(0.9); }
        
        .bet-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #aaa;
            font-size: 0.8rem;
        }
        .bet-val { font-size: 1.2rem; color: #fff; font-weight: bold; margin: 5px 0; }
        .btn-mini { background: #333; border: 1px solid #555; color: #fff; width: 30px; height: 30px; border-radius: 5px; }

        /* --- MENÃœ (SIDEBAR) --- */
        .sidebar {
            position: fixed;
            left: -300px;
            top: 0;
            width: 280px;
            height: 100%;
            background: rgba(10, 10, 20, 0.98);
            border-right: 2px solid var(--neon-blue);
            z-index: 1000;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }
        .sidebar.open { left: 0; }
        
        .producer-tag {
            margin-top: auto;
            text-align: center;
            padding: 20px;
            border-top: 1px solid #333;
            color: var(--neon-green);
            font-weight: 900;
            letter-spacing: 2px;
            animation: flash 3s infinite;
        }

        .menu-item {
            padding: 15px;
            margin: 5px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: 0.2s;
        }
        .menu-item:hover { background: var(--neon-blue); color: #000; }

        /* --- BONUS BÄ°LDÄ°RÄ°MÄ° --- */
        .bonus-alert {
            position: absolute;
            top: 80px; right: -200px;
            background: var(--neon-green);
            color: #000;
            padding: 10px 20px;
            border-radius: 10px 0 0 10px;
            font-weight: bold;
            transition: 0.5s;
            z-index: 999;
            box-shadow: 0 0 15px var(--neon-green);
        }
        .bonus-alert.show { right: 0; }

        /* --- MOBÄ°L UYUMLULUK --- */
        @media (max-width: 400px) {
            .symbol { font-size: 1.5rem; }
            .game-grid { gap: 3px; }
        }
    </style>
</head>
<body>

    <div class="sidebar" id="sidebar">
        <h2 style="color:var(--neon-blue); text-align:center;">AYARLAR</h2>
        <div class="menu-item" onclick="joinRoomPrompt()"><i class="fas fa-globe"></i> Online Odaya Gir</div>
        <div class="menu-item" onclick="leaveRoom()"><i class="fas fa-sign-out-alt"></i> Odadan AyrÄ±l</div>
        <div class="menu-item" onclick="resetData()"><i class="fas fa-trash"></i> Verileri SÄ±fÄ±rla</div>
        <div class="menu-item"><i class="fas fa-palette"></i> Tema: Cyberpunk</div>
        
        <div style="margin-top:20px; color:#888; font-size:0.8rem; text-align:center;">
            Server Durumu: <span id="server-status" style="color:red">OFFLINE</span>
        </div>

        <div class="producer-tag">
            YAPIMCI<br>KEKECAN
        </div>
    </div>

    <div class="top-bar">
        <i class="fas fa-bars menu-icon" onclick="toggleMenu()"></i>
        <div class="balance-box">
            <i class="fas fa-lira-sign"></i> <span id="balance">5000</span>
        </div>
        <div style="font-size:0.8rem; color:var(--neon-pink); font-weight:bold;">
            <i class="fas fa-trophy"></i> <span id="last-win">0</span>
        </div>
    </div>

    <div class="bonus-alert" id="bonus-alert">
        +2.000 TL BONUS GELDÄ°!
    </div>

    <div id="game-area">
        <div class="game-grid" id="grid"></div>
        <div id="win-overlay" style="position:absolute; font-size:3rem; font-weight:900; color:var(--gold); display:none; text-shadow:0 0 20px #000;">BIG WIN!</div>
    </div>

    <div class="controls">
        <div class="bet-control">
            <span>BAHÄ°S</span>
            <div style="display:flex; align-items:center; gap:5px;">
                <button class="btn-mini" onclick="adjBet(-100)">-</button>
                <span class="bet-val" id="bet">100</span>
                <button class="btn-mini" onclick="adjBet(100)">+</button>
            </div>
        </div>

        <button class="spin-btn" id="spin-btn" onclick="spin()">SPIN</button>

        <div class="bet-control">
            <span>OTO</span>
            <button class="btn-mini" onclick="toggleAuto()" id="auto-btn" style="width:50px;">OFF</button>
        </div>
    </div>

<script>
    // --- FIREBASE YAPILANDIRMASI (SENÄ°N ATTIÄžIN KEYLER) ---
    const firebaseConfig = {
      apiKey: "AIzaSyAeDY4Bv6hWopJrfeJ7nfgPJRd9VYGEx8B",
      authDomain: "sweet-masters-82504.firebaseapp.com",
      databaseURL: "https://sweet-masters-82504-default-rtdb.firebaseio.com",
      projectId: "sweet-masters-82504",
      storageBucket: "sweet-masters-82504.firebasestorage.app",
      messagingSenderId: "600834822835",
      appId: "1:600834822835:web:db3ea440ccce2031a956c6"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    // OYUNCU KÄ°MLÄ°ÄžÄ° OLUÅžTUR VEYA YÃœKLE
    let userId = localStorage.getItem('sm_uid');
    if(!userId) {
        userId = "oyuncu_" + Math.floor(Math.random()*99999);
        localStorage.setItem('sm_uid', userId);
    }

    // --- OYUN DEÄžÄ°ÅžKENLERÄ° ---
    const SYMBOLS = ['ðŸ’Ž', 'â­', 'ðŸ‡', 'ðŸ‰', 'ðŸŒ', 'ðŸ’', 'ðŸ‹', 'ðŸ’£'];
    let state = {
        balance: parseInt(localStorage.getItem('sm_bal')) || 5000,
        bet: 100,
        spinning: false,
        auto: false,
        roomID: null,
        greenLight: false // x10 Modu
    };

    // --- BAÅžLANGIÃ‡ ---
    window.onload = () => {
        updateUI();
        createGrid();
        startBonusTimer(); // Para daÄŸÄ±tma sistemi
    };

    function createGrid() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        for(let i=0; i<30; i++) {
            let cell = document.createElement('div');
            cell.className = 'symbol';
            cell.innerText = getRandomSymbol();
            grid.appendChild(cell);
        }
    }

    function getRandomSymbol() {
        // BombayÄ± (ðŸ’£) daha az getir
        let rand = Math.random();
        if(rand < 0.05) return 'ðŸ’£'; // Scatter
        if(rand < 0.15) return 'ðŸ’Ž'; // YÃ¼ksek
        return SYMBOLS[Math.floor(Math.random() * (SYMBOLS.length - 2)) + 2];
    }

    // --- SPIN MEKANÄ°ÄžÄ° ---
    async function spin() {
        if(state.spinning || state.balance < state.bet) return;
        
        state.spinning = true;
        state.balance -= state.bet;
        updateUI();
        document.getElementById('spin-btn').style.transform = "scale(0.9)";

        // YEÅžÄ°L IÅžIK EVENTÄ° (%10 Ä°htimal)
        state.greenLight = Math.random() < 0.1;
        if(state.greenLight) {
            document.querySelector('.game-grid').classList.add('green-light-mode');
            Swal.fire({
                toast: true, position: 'top', icon: 'success', 
                title: 'YEÅžÄ°L IÅžIK! KazanÃ§lar x10', showConfirmButton: false, timer: 1500
            });
        } else {
            document.querySelector('.game-grid').classList.remove('green-light-mode');
        }

        // Animasyon
        const cells = document.querySelectorAll('.symbol');
        cells.forEach((c, i) => {
            c.classList.add('falling');
            setTimeout(() => {
                c.innerText = getRandomSymbol();
                c.classList.remove('falling');
            }, i * 20); // DalgalÄ± dÃ¼ÅŸÃ¼ÅŸ
        });

        // Online Sync
        if(state.roomID) {
            db.ref(`rooms/${state.roomID}/${userId}`).update({
                action: 'spinning',
                time: Date.now()
            });
        }

        await new Promise(r => setTimeout(r, 800));
        checkWin();
        document.getElementById('spin-btn').style.transform = "scale(1)";
    }

    function checkWin() {
        const cells = document.querySelectorAll('.symbol');
        let counts = {};
        cells.forEach(c => counts[c.innerText] = (counts[c.innerText] || 0) + 1);

        let win = 0;
        // KAZANMA MANTIÄžI (6 EÅŸleÅŸme Yeterli - Daha Ã§ok kazandÄ±rÄ±r)
        for(let sym in counts) {
            if(counts[sym] >= 6) {
                let baseVal = SYMBOLS.indexOf(sym) + 1; // Basit deÄŸer hesabÄ±
                if(sym === 'ðŸ’Ž') baseVal = 50;
                if(sym === 'ðŸ’£') baseVal = 0; // Bomba puan vermez, patlatÄ±r
                
                win += (baseVal * counts[sym] * (state.bet / 20));
            }
        }

        if(state.greenLight) win *= 10;

        if(win > 0) {
            state.balance += win;
            showWinEffect(win);
            // Online Sync Win
            if(state.roomID) {
                db.ref(`rooms/${state.roomID}/${userId}`).update({
                    lastWin: win,
                    action: 'win'
                });
            }
        }

        state.spinning = false;
        updateUI();

        if(state.auto && state.balance >= state.bet) {
            setTimeout(spin, 1200);
        }
    }

    function showWinEffect(amount) {
        const overlay = document.getElementById('win-overlay');
        overlay.innerText = "+" + Math.floor(amount);
        overlay.style.display = 'block';
        overlay.classList.add('animate__animated', 'animate__bounceIn');
        
        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });

        setTimeout(() => {
            overlay.style.display = 'none';
            overlay.classList.remove('animate__animated', 'animate__bounceIn');
        }, 1500);
    }

    // --- PARA DAÄžITMA SÄ°STEMÄ° (BAÄžIMLILIK MODU) ---
    function startBonusTimer() {
        setInterval(() => {
            state.balance += 2000;
            updateUI();
            
            const alert = document.getElementById('bonus-alert');
            alert.classList.add('show');
            setTimeout(() => alert.classList.remove('show'), 3000);
            
            playSound('coin'); // Varsa ses Ã§alar
        }, 300000); // 300.000 ms = 5 Dakika
    }

    // --- ONLINE ODA SÄ°STEMÄ° ---
    async function joinRoomPrompt() {
        const { value: room } = await Swal.fire({
            title: 'Oda Ä°smi Gir',
            input: 'text',
            background: '#111', color: '#fff',
            confirmButtonColor: '#ff0055'
        });

        if(room) {
            state.roomID = room;
            const userRef = db.ref(`rooms/${room}/${userId}`);
            
            userRef.set({
                name: userId,
                balance: state.balance,
                status: 'online'
            });

            // AyrÄ±lÄ±nca sil
            userRef.onDisconnect().remove();

            document.getElementById('server-status').innerText = "ONLINE: " + room;
            document.getElementById('server-status').style.color = "#00ff66";
            toggleMenu();
            Swal.fire('BaÄŸlandÄ±!', `${room} odasÄ±ndasÄ±n.`, 'success');
        }
    }

    function leaveRoom() {
        if(!state.roomID) return;
        db.ref(`rooms/${state.roomID}/${userId}`).remove();
        state.roomID = null;
        document.getElementById('server-status').innerText = "OFFLINE";
        document.getElementById('server-status').style.color = "red";
        toggleMenu();
        Swal.fire('AyrÄ±ldÄ±n', 'Offline moda geÃ§ildi.', 'info');
    }

    // --- UI & YARDIMCI ---
    function updateUI() {
        document.getElementById('balance').innerText = Math.floor(state.balance).toLocaleString();
        document.getElementById('bet').innerText = state.bet;
        document.getElementById('last-win').innerText = localStorage.getItem('sm_last_win') || 0;
        localStorage.setItem('sm_bal', state.balance);
    }

    function adjBet(val) {
        if(state.bet + val >= 100) {
            state.bet += val;
            updateUI();
        }
    }

    function toggleAuto() {
        state.auto = !state.auto;
        document.getElementById('auto-btn').innerText = state.auto ? "ON" : "OFF";
        document.getElementById('auto-btn').style.background = state.auto ? "#00ff66" : "#333";
        if(state.auto) spin();
    }

    function toggleMenu() {
        document.getElementById('sidebar').classList.toggle('open');
    }

    function resetData() {
        localStorage.clear();
        location.reload();
    }
</script>
</body>
</html>
